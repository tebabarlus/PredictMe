<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Events</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        accent: '#d6f94a',
                        'accent-dark': '#b7f34d',
                        'accent-light': '#d9ff66',
                        purple: '#6b21a8',
                        blue: '#6b6bff',
                        pink: '#f472b6',
                        // Added telegram colors for consistency
                        'tg-bg': '#17212b',
                        'tg-secondary-bg': '#232e3c',
                        'tg-text': '#f5f5f5',
                        'tg-hint': '#708499',
                        'tg-link': '#6ab3f3',
                        'tg-button': '#5288c1',
                        'tg-destructive': '#ec3942'
                    }
                }
            }
        }
    </script>
</head>

<body class="font-['Inter',sans-serif] m-0 p-0 text-white bg-gradient-to-b from-[#300c2b] to-black min-h-screen">
    <div class="relative mb-4"> <img src="Predictmelogo.svg" alt="Predictme Logo" class="h-12" style="padding-top: 20px; margin: auto; "></div>
    <div class="content-wrapper">
        <div class="container max-w-md w-full mx-auto px-4">
            <div class="relative mb-4">
                <input id="search-input" placeholder="Search" type="text" class="form-input rounded-full px-4 py-2"
                    style="margin-bottom: 0;">
            </div>
            <nav class="nav-tabs space-x-2 overflow-x-auto pb-2 mb-4 scrollbar-hide" id="category-filter"> <a
                    class="nav-tab filter-item whitespace-nowrap active" href="#" data-category="all">Top</a> <a
                    class="nav-tab filter-item whitespace-nowrap" href="#" data-category="crypto">Crypto</a> <a
                    class="nav-tab filter-item whitespace-nowrap" href="#" data-category="sports">Sports</a> <a
                    class="nav-tab filter-item whitespace-nowrap" href="#" data-category="ortak">Ortak</a> <a
                    class="nav-tab filter-item whitespace-nowrap" href="#" data-category="event1">Event1</a><a
                    class="nav-tab filter-item whitespace-nowrap" href="#" data-category="event2">Event2</a><a
                    class="nav-tab filter-item whitespace-nowrap" href="#" data-category="event3">Event3</a>
            </nav>

            <script>
                // Add filter functionality
                document.addEventListener('DOMContentLoaded', function () {
                    const filterItems = document.querySelectorAll('.filter-item');

                    // Apply styles based on active state
                    function updateFilterStyles() {
                        filterItems.forEach(item => {
                            if (item.classList.contains('active')) {
                                item.classList.add('nav-tab-active');
                                item.classList.remove('nav-tab'); // Ensure inactive styles are removed
                            } else {
                                item.classList.add('nav-tab'); // Ensure inactive styles are added
                                item.classList.remove('nav-tab-active'); // Ensure active styles are removed
                            }
                        });
                    }

                    // Initialize styles
                    updateFilterStyles();

                    // Add click event listeners
                    filterItems.forEach(item => {
                        item.addEventListener('click', function (e) {
                            e.preventDefault();

                            // Remove active class from all items
                            filterItems.forEach(i => i.classList.remove('active'));

                            // Add active class to clicked item
                            this.classList.add('active');

                            // Update styles
                            updateFilterStyles();

                            // Get category
                            const category = this.getAttribute('data-category');
                            console.log('Filtering by:', category);

                            // Add your filtering logic here
                            // For example, show/hide prediction items based on category
                        });
                    });
                });
            </script>
            <section class="space-y-6" id="events-container">
                <!-- Events will be loaded dynamically here -->
                <div class="text-center py-10">
                    <i class="fas fa-circle-notch fa-spin text-2xl"></i>
                    <p class="mt-3">Loading events...</p>
                </div>>
                                    Bitcoin to close at <span class="font-bold">$96,000 or higher on May 1?</span>
                                </p>
                                <div class="flex items-center gap-1 text-gray-400"> <i class="fas fa-users"></i>
                                    <span>8</span>
                                </div>
                            </div>
                            <div class="flex gap-4 mt-1 text-xs font-semibold"> <span
                                    class="text-accent-dark">37%</span>
                                <span>Yes</span>
                                <span><i class="fas fa-link"></i></span>
                                <span class="text-accent-dark">160%</span>
                                <span class="text-purple">60%</span>
                                <span><i class="fas fa-link"></i></span>
                                <span class="font-bold text-gray-400"> <i class="fas fa-clock"></i> 2 days 14 hours
                                </span>
                            </div>
                        </div>
                    </a>
                </article>
                <article class="card bg-white/15 rounded-lg overflow-hidden hover:bg-white/10 transition-colors p-0"> <a
                        href="prediction-details.html" class="block">
                        <div class="relative">
                            <img alt="Blue masked face inside a keyhole shape on black background"
                                class="w-full h-48 object-cover"
                                src="https://www.olg.ca/content/dam/olg/web/product/casino/2024/april-june-2024/may/sweet-bonaza-1000/desktop-carousel-logo.png" />
                            <div class="absolute top-2 right-2 flex flex-col gap-1">
                                <span
                                    class="bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full px-2 py-1 flex items-center">
                                    <i class="fas fa-fire mr-1"></i>
                                    Hot
                                </span>
                                <span
                                    class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-xs rounded-full px-2 py-1 flex items-center">
                                    <i class="fas fa-star mr-1"></i>
                                    New
                                </span>
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center mt-2 text-sm font-semibold">
                                <p class="flex-grow">
                                    Will Ortak Sweet Bonanza 1000 Snowball be higher 97.5% ?
                                </p>
                                <div class="flex items-center gap-1 text-gray-400"> <i class="fas fa-users"></i>
                                    <span>1</span>
                                </div>
                            </div>
                            <div class="flex gap-4 mt-1 text-xs font-semibold"> <span class="text-accent-dark">0%</span>
                                <span>Yes</span>
                                <span><i class="fas fa-link"></i></span>
                                <span class="text-accent-dark">25%</span>
                                <span class="text-blue">1%</span>
                                <span><i class="fas fa-link"></i></span>
                                <span class="font-bold text-gray-400"> <i class="fas fa-clock"></i> 5 days 14 hours
                                </span>
                            </div>
                        </div>
                    </a>
                </article>
            </section>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="bottom-nav-container max-w-md mx-auto flex justify-around"> <a href="events.html"
                class="bottom-nav-item bottom-nav-item-active"> <i class="bottom-nav-icon far fa-comment-alt"></i> <span
                    class="text-xs">Events</span> </a>
            <a href="add.html" class="bottom-nav-item"> <i class="bottom-nav-icon fas fa-plus"></i> <span
                    class="text-xs">Add</span> </a>
            <a href="profile.html" class="bottom-nav-item"> <i class="bottom-nav-icon far fa-user"></i> <span
                    class="text-xs">Profile</span> </a>
        </div>
    </nav>

    <!-- Add API JavaScript file -->
    <script src="js/api.js"></script>
    
    <!-- Events page specific script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load events from API
            loadEvents();
            
            // Set up category filtering
            const filterItems = document.querySelectorAll('.filter-item');
            filterItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active state
                    filterItems.forEach(i => i.classList.remove('active', 'nav-tab-active'));
                    filterItems.forEach(i => i.classList.add('nav-tab'));
                    this.classList.add('active', 'nav-tab-active');
                    this.classList.remove('nav-tab');
                    
                    // Get category and load events
                    const category = this.getAttribute('data-category');
                    loadEvents(category);
                });
            });
            
            // Set up search functionality
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    filterEventsBySearch(searchTerm);
                }, 300));
            }
            
            // Check if user is authenticated on page load
            checkAuthenticationStatus();
        });
        
        // Load events from the API
        async function loadEvents(category = 'all') {
            try {
                const eventsSection = document.querySelector('section.space-y-6');
                
                // Show loading state
                eventsSection.innerHTML = '<div class="text-center py-10"><i class="fas fa-circle-notch fa-spin text-2xl"></i><p class="mt-3">Loading events...</p></div>';
                
                // Fetch events from API
                const events = await PredictMeAPI.getEvents(category);
                
                if (!events || events.length === 0) {
                    eventsSection.innerHTML = '<div class="text-center py-10"><i class="fas fa-search text-2xl mb-3"></i><p>No events found</p></div>';
                    return;
                }
                
                // Render events
                eventsSection.innerHTML = '';
                events.forEach(event => {
                    const eventHtml = createEventCard(event);
                    eventsSection.innerHTML += eventHtml;
                });
            } catch (error) {
                console.error('Error loading events:', error);
                document.querySelector('section.space-y-6').innerHTML = 
                    '<div class="text-center py-10"><i class="fas fa-exclamation-circle text-2xl mb-3 text-red-500"></i><p>Failed to load events. Please try again later.</p></div>';
            }
        }
        
        // Create HTML for an event card
        function createEventCard(event) {
            // Safety check for valid event object
            if (!event || typeof event !== 'object') {
                console.error('Invalid event data:', event);
                return ''; // Return empty string if event is invalid
            }
            
            // Safely access properties with defaults
            const title = event.title || 'Untitled Event';
            const description = event.description || 'No description provided';
            const id = event.id || 'unknown';
            const category = event.category || 'general';
            
            // We have this defined below, removing duplicate declaration

            // Format remaining time - handle invalid dates
            let timeDisplay = 'Time remaining';
            try {
                const endDate = new Date(event.end_time || new Date());
                const now = new Date();
                
                // Check if date is valid
                if (!isNaN(endDate.getTime())) {
                    const diffMs = endDate - now;
                    
                    if (diffMs <= 0) {
                        timeDisplay = 'Ended';
                    } else {
                        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                        const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                        
                        if (diffDays > 0) {
                            timeDisplay = `${diffDays} day${diffDays !== 1 ? 's' : ''}`;
                        } else {
                            timeDisplay = `${diffHours} hours ${diffMinutes} min`;
                        }
                    }
                }
            } catch (error) {
                console.error('Error calculating time display:', error);
            }
            
            // Handle options safely
            const options = Array.isArray(event.options) ? event.options : [];
            
            // Calculate percentages for display
            let yesPercentage = 50;
            let noPercentage = 50;
            
            if (options.length >= 2) {
                // This would come from API in real implementation
                // For now, we'll use random values for display purposes
                yesPercentage = Math.round(Math.random() * 100); 
                noPercentage = 100 - yesPercentage;
            }
            
            // Default image if none provided
            const imageUrl = event.image_url || 'https://placehold.co/800x400/gray/white?text=Event+Image';
            
            // Get category badge color
            const categoryColors = {
                'crypto': 'bg-yellow-600',
                'sports': 'bg-blue-600',
                'politics': 'bg-red-600',
                'entertainment': 'bg-purple-600',
                'tech': 'bg-green-600',
                'general': 'bg-gray-600'
            };
            
            const categoryColor = categoryColors[category] || 'bg-gray-600';
            
            return `
                <article class="card bg-white/15 rounded-lg overflow-hidden hover:bg-white/10 transition-colors p-0">
                    <a href="prediction-details.html?id=${id}" class="block">
                        <div class="relative">
                            <img alt="${title}" class="w-full h-48 object-cover" src="${imageUrl}" />
                            <div class="absolute top-2 right-2 flex flex-col gap-1">
                                <span class="${categoryColor} text-white text-xs rounded-full px-2 py-1 flex items-center">
                                    <i class="fas fa-tag mr-1"></i> ${category}
                                </span>
                                <span class="bg-black/60 text-white text-xs rounded-full px-2 py-1 flex items-center">
                                    <i class="fas fa-clock mr-1"></i> ${timeDisplay}
                                </span>
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center mt-2 text-sm font-semibold">
                                <p class="flex-grow">${event.title}</p>
                                <div class="flex items-center gap-1 text-gray-400">
                                    <i class="fas fa-users"></i>
                                    <span>21</span>
                                </div>
                            </div>
                            <div class="flex gap-4 mt-1 text-xs font-semibold">
                                <span class="text-accent-dark">${yesPercentage}%</span>
                                <span>Yes</span>
                                <span><i class="fas fa-link"></i></span>
                                <span class="text-purple">${noPercentage}%</span>
                                <span class="font-bold text-gray-400">
                                    <i class="fas fa-clock"></i> ${timeDisplay}
                                </span>
                            </div>
                        </div>
                    </a>
                </article>
            `;
        }
        
        // Filter events by search term
        function filterEventsBySearch(searchTerm) {
            const eventArticles = document.querySelectorAll('section.space-y-6 article');
            
            if (!searchTerm) {
                // If no search term, show all events
                eventArticles.forEach(article => {
                    article.style.display = 'block';
                });
                return;
            }
            
            let hasResults = false;
            
            // Filter events by title
            eventArticles.forEach(article => {
                const titleElement = article.querySelector('p.flex-grow');
                if (!titleElement) return;
                
                const title = titleElement.textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    article.style.display = 'block';
                    hasResults = true;
                } else {
                    article.style.display = 'none';
                }
            });
            
            // Show no results message if needed
            const noResultsEl = document.querySelector('.no-results-message');
            if (!hasResults) {
                if (!noResultsEl) {
                    const message = document.createElement('div');
                    message.className = 'no-results-message text-center py-8';
                    message.innerHTML = `<i class="fas fa-search text-2xl mb-3"></i><p>No events found matching "${searchTerm}"</p>`;
                    document.querySelector('section.space-y-6').appendChild(message);
                }
            } else if (noResultsEl) {
                noResultsEl.remove();
            }
        }
        
        // Check if user is authenticated
        function checkAuthenticationStatus() {
            if (PredictMeAPI.isAuthenticated()) {
                // Update UI for logged in user
                const user = PredictMeAPI.getCurrentUser();
                if (user) {
                    // You can add additional UI updates here
                    console.log('User is authenticated:', user);
                }
            }
        }
        
        // Debounce function for search input
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }
    </script>
</body>

</html>